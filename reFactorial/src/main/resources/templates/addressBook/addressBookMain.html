<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>주소록</title>
    <!-- 폰트 적용 -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100..900&display=swap" rel="stylesheet">

    <link rel="stylesheet" th:href="@{/css/common/header.css}">
    <link rel="stylesheet" th:href="@{/css/common/footer.css}">
    <link rel="stylesheet" th:href="@{/css/common/style.css}">

    <link rel="stylesheet" th:href="@{/css/addressBook/addressBookMain.css}">
    <style>

    </style>
</head>
<body>

    <header th:replace="~{/common/header::headerFragment}"></header>


    <section class="container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-title">주소록</div>
            <ul>
                <li><a href="/addressBook/addressBookMain">사내 직원</a></li>
                <li><a href="/addressBook/partners">협력 업체</a></li>
            </ul>
        </div>

        <!-- 메인 컨텐츠 -->
        <div class="main-content">
            <!-- 검색 바 -->
            <div class="top-bar">
                <input type="text" id="search-input" placeholder="이름 또는 부서명 검색">
                <button onclick="searchEmployees()">검색</button>
            </div>

            <!-- 테이블 -->
            <div class="table-header">
                <div class="table-cell">사번</div>
                <div class="table-cell">이름</div>
                <div class="table-cell">부서</div>
                <div class="table-cell">직책</div>
                <div class="table-cell">이메일</div>
                <div class="table-cell">전화번호</div>
            </div>
            <div id="employee-list">
                <!-- 여기에서 검색 결과가 실시간으로 표시됩니다 -->
            </div>


        </div>
    </section>

<script>
    // 페이지 로드 시 전체 직원 조회 실행
    document.addEventListener('DOMContentLoaded', function () {
        fetchEmployees(); // 페이지 로드 시 전체 직원 조회
    });

    // 검색 입력에서 엔터키를 감지하여 검색 실행
    document.getElementById('search-input').addEventListener('keyup', function (event) {
        if (event.key === 'Enter') {
            searchEmployees(); // 엔터키로 검색 실행
        }
    });

    // 검색 입력에서 입력할 때마다 실시간 검색 실행
    document.getElementById('search-input').addEventListener('input', function () {
        const searchValue = this.value.trim();
        if (searchValue === "") {
            fetchEmployees(); // 입력값이 없으면 전체 조회 실행
        } else {
            searchEmployees(); // 실시간 검색 실행
        }
    });

    // 전체 직원 조회 함수
    function fetchEmployees() {
        fetch('/addressBook/employees')
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => renderEmployees(data))
            .catch(error => console.error('Error fetching employees:', error));
    }

    // 검색 실행 함수
    function searchEmployees() {
        const searchValue = document.getElementById('search-input').value.trim();

        fetch(`/addressBook/search?keyword=${searchValue}`)
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(data => renderEmployees(data))
            .catch(error => console.error('Error fetching employees:', error));
    }

    // 데이터를 테이블에 렌더링하는 함수
    function renderEmployees(data) {
        const tableBody = document.getElementById('employee-list');
        tableBody.innerHTML = ""; // 기존 데이터를 초기화

        if (data.length === 0) {
            tableBody.innerHTML = `<div class="table-row">검색 결과가 없습니다.</div>`;
            return;
        }

        data.forEach(employee => {
            const row = document.createElement('div');
            row.className = "table-row";

            // 각 직원 데이터를 테이블 셀에 추가
            row.innerHTML = `
            <div class="table-cell">${employee.id}</div>
            <div class="table-cell">${employee.name}</div>
            <div class="table-cell">${employee.deptName}</div>
            <div class="table-cell">${employee.positionName}</div>
            <div class="table-cell">${employee.email}</div>
            <div class="table-cell">${employee.phone}</div>
        `;

            tableBody.appendChild(row);
        });
    }


</script>
    <footer th:replace="~{/common/footer::footerFragment}"></footer>
</body>
</html>
