<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>문의 상세</title>
    <link rel="stylesheet" href="/css/style.css">
    <style>
        .pagination {
            display: flex; /* 플렉스 레이아웃 사용 */
            justify-content: center; /* 페이지네이션 버튼을 가로로 중앙 정렬 */
            align-items: center; /* 수직 중앙 정렬 */
            margin-top: 20px; /* 상단 여백 추가 */
        }

        .pagination button {
            padding: 5px 10px; /* 버튼 내부 여백 */
            margin: 0 5px; /* 버튼 간 간격 */
            background-color: #f0f0f0; /* 버튼 배경색 */
            border: 1px solid #ccc; /* 버튼 테두리 색상 */
            border-radius: 5px; /* 둥근 모서리 */
            cursor: pointer; /* 마우스 커서 설정 */
        }

        .pagination button:hover {
            background-color: #ddd; /* 마우스 오버 시 배경색 변경 */
        }
    </style>
</head>
<body>
<header>
    <nav>
        <!-- 네비게이션 바 (기본적인 메뉴들) -->
    </nav>
</header>

<section class="inquiry-detail">
    <h1>문의 상세</h1>

    <table>
        <tr>
            <th>제목</th>
            <td th:text="${adminInquiries.iqrTitle}"></td>
        </tr>
        <tr>
            <th>내용</th>
            <td th:text="${adminInquiries.iqrDetails}"></td>
        </tr>
        <tr>
            <th>답변 상태</th>
            <td th:text="${adminInquiries.answerStatus ? '답변 완료' : '답변 대기 중'}"></td>
        </tr>
        <tr>
            <th>작성일</th>
            <td th:text="${adminInquiries.iqrCreationDate}"></td>
        </tr>
        <tr>
            <th>답변 내용</th>
            <td th:text="${adminInquiries.answerDetail != null ? adminInquiries.answerDetail : '없음'}"></td>
        </tr>
        <tr>
            <th>문의 고유 ID (iqrValue)</th>
            <td th:text="${adminInquiries.iqrValue}"></td>
        </tr>
    </table>

    <div>
        <form th:if="${!adminInquiries.answerStatus}" method="POST" action="/inquiry/adminInquiryAnswer">
            <textarea id="answerDetail" class="answerDetail" name="answerDetail" placeholder="답변을 입력하세요..."></textarea>
            <input type="hidden" name="iqrValue" th:value="${adminInquiries.iqrValue}"/>
            <button type="submit">답변하기</button>
        </form>
    </div>

    <script>
        function submitAnswer(iqrValue) {
            const answerDetail = document.getElementById("answerDetail").value; // 텍스트영역의 답변 내용 가져오기
            const params = new URLSearchParams();
            params.append('iqrValue', iqrValue); // 실제 iqrValue 값을 서버로 전달
            params.append('answerDetail', answerDetail);
            console.log("iqrValue:", iqrValue); // 추가된 로그

            fetch('/inquiry/adminInquiryAnswer', {
                method: 'POST',
                body: params,
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' }
            })
                .then(response => response.text())
                .then(result => {
                    console.log("Result:", result); // 응답 로그 확인
                    if (result === 'success') {
                        alert('답변이 등록되었습니다.');
                        location.reload(); // 페이지 새로고침
                    } else {
                        alert('답변 등록에 실패했습니다.');
                    }
                })
                .catch(err => {
                    console.error("Error:", err);
                    alert('네트워크 오류가 발생했습니다.');
                });
        }
    </script>

    <div th:each="file : ${attachmentFileList}"> <!-- 파일 첨부 -->
        <a class="attachmentFile" th:href="@{/files/downLoad(fileId=${file.fileId})}" th:text="${file.originFileName}">첨부 파일</a>
    </div>

    <div class="back-button">
        <a href="/inquiry/inquiryList">목록으로 돌아가기</a>
    </div>
</section>

<footer>
    <!-- Footer content -->
</footer>
</body>
</html>
