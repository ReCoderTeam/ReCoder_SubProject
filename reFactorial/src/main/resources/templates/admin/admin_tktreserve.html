<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>

    <!-- 공통 복사 -->
    <link rel="stylesheet" th:href="@{/css/admin/common/admin_header.css}">
    <link rel="stylesheet" th:href="@{/css/common/footer.css}">
    <link rel="stylesheet" th:href="@{/css/admin/common/admin_style.css}">
    <link rel="stylesheet" th:href="@{/css/admin/common/admin_circleBtn.css}">
    <!-- 여기 까지 -->

    <link rel="stylesheet" th:href="@{/css/admin/admin_tktreserve.css}">
    <link rel="stylesheet" href="../../static/css/admin/admin_tktreserve.css">
</head>
<body>
    <header th:replace="~{admin/common/admin_header::adminHeaderFragment}"></header>
    <section>
        <div class="leftBox">
            <div th:replace="~{admin/common/admin_circle_menu::adminCircleMenuFragment}"></div>
        </div>

        <div class="rightBox">
            <div class="sideMenu">
                <div class="sideTitle">예약자 관리</div>

                <div>
                    <label for="searchDate">날짜</label>
                    <input type="date" name="searchDate" id="searchDate">
                </div>
            </div>
            <form action="/admin/extractPDF" method="post" id="extractForm">
                <div class="menuMainBox">
                    <div class="tktreserve_item_box">
                    </div>
                </div>
                <button id="extractFormSubmitBtn" type="submit">추출하기</button>
            </form>
        </div>
    </section>
    <footer th:replace="~{common/footer::footerFragment}"></footer>

    <script>
        const searchDate = document.querySelector("#searchDate");
        const dataBox = document.querySelector(".tktreserve_item_box");

        searchDate.addEventListener("change",()=>{
            dataBox.innerHTML=''
            getTktReserve();
        })

        const formatPhoneNumber = (phone) => {
            return phone.replace(/(\d{3})(\d{4})(\d{4})/, '$1-$2-$3');
        };

        const getTktReserve = () =>{
            let selectedDay = searchDate.value;
            const imgList = ['umpa1.png','umpa2.png','squirrel.png']

            console.log("selectedDay : ",selectedDay)

            fetch(`/admin/getTktReserve?selectedDay=${selectedDay}`,{
                method : 'GET',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
                .then(response => response.json())
                .then(data =>{
                    console.log("예약자 데이터 : ",data)

                    if (data.resultList.length == 0){
                        dataBox.innerHTML=`<div class="notMatch">해당 날짜에 예약자가 없습니다.</div>`
                    } else{

                    data.resultList.forEach(data =>{
                        const randomNum = Math.floor(Math.random() * 3)

                        const item = `
                            <div class="tktreserve_item">
                                <input type="checkbox" name="select_tkt[]" id="select_tkt" value="${data.tktReserveId}">
                                <div class="random_img">
                                    <img src="/images/${imgList[randomNum]}" alt="사진">
                                </div>
                                <div class="tkt_names">
                                    <div>${data.tktReserveName}, </div>
                                    <div>${data.tktReserveAccomp}</div>
                                </div>
                                <div class="tkt_date">${data.tktReserveDate}</div>
                                <div class="tkt_phone">${formatPhoneNumber(data.tktReservePhone)}</div>
                            </div>
                        `
                            dataBox.innerHTML += item
                        })
                    }
                })
        }

        document.addEventListener("DOMContentLoaded", ()=>{
            getTktReserve();
        })

    </script>

</body>
</html>