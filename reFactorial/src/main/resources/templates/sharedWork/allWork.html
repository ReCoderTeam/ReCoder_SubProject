<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>

    <!--폰트 적용-->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@100..900&display=swap" rel="stylesheet">

    <link rel="stylesheet" th:href="@{/css/common/header.css}">
    <link rel="stylesheet" th:href="@{/css/common/footer.css}">
    <link rel="stylesheet" th:href="@{/css/common/style.css}">
    <link rel="stylesheet" th:href="@{/css/sharedWork/sharedWork.css}">
</head>
<body>

<header th:replace="~{/common/header::headerFragment}"></header>
<section>
    <div class="container">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-title">업무공유</div>
            <ul>
                <li onclick="location.href='sharedWork/allWork'">전체업무</li>
                <li>업무공유</li>
            </ul>
        </div>

        <!-- 메인 폼 -->
        <div class="main-content">
            <!-- 캘린더 출력 -->
            <div id='calendar'></div>

            <!-- 모달 팝업 -->
            <div class="modal-overlay" id="modal-overlay"></div>
            <div class="modal" id="modal">
                <h2>일정 공유</h2>
                <label for="eventTitle">제목:</label>
                <input type="text" id="eventTitle" placeholder="일정 제목을 입력하세요">
                <label for="eventDescription">설명:</label>
                <textarea id="eventDescription" placeholder="일정 설명을 입력하세요"></textarea>
                <label for="eventStartDate">시작 날짜</label>
                <input type="date" id="eventStartDate">
                <label for="eventEndDate">종료 날짜</label>
                <input type="date" id="eventEndDate">

                <!-- 부서 선택 -->
                <label for="departmentSelect">부서:</label>
                <select id="departmentSelect">
                    <option value="1">인사팀</option>
                    <option value="2">개발팀</option>
                    <option value="3">마케팅팀</option>
                    <option value="4">회계팀</option>
                    <option value="5">영업팀</option>
                </select>

                <div id="selectedColor" style="margin-top: 10px;">선택된 색상: <span id="colorDisplay" style="padding: 5px;"></span></div>

                <button id="saveEventBtn">저장</button>
                <button id="deleteEventBtn">삭제</button>
                <button id="closeModalBtn">닫기</button>
            </div>
        </div>
    </div>
</section>

<footer th:replace="~{/common/footer::footerFragment}"></footer>

<!-- 캘린더 스크립트 -->
<script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js'></script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        var calendarEl = document.getElementById('calendar');
        var modal = document.getElementById('modal');
        var modalOverlay = document.getElementById('modal-overlay');
        var closeModalBtn = document.getElementById('closeModalBtn');
        var saveEventBtn = document.getElementById('saveEventBtn');
        var deleteEventBtn = document.getElementById('deleteEventBtn');
        var eventTitleInput = document.getElementById('eventTitle');
        var eventDescriptionInput = document.getElementById('eventDescription');
        var eventStartDateInput = document.getElementById('eventStartDate');
        var eventEndDateInput = document.getElementById('eventEndDate');
        var departmentSelect = document.getElementById('departmentSelect');
        var colorDisplay = document.getElementById('colorDisplay');

        // 부서별 색상 설정 (dept_code와 매핑)
        var departmentColors = {
            1: '#FF5733', // 인사팀 (주황색)
            2: '#33FF57', // 개발팀 (초록색)
            3: '#FF33A1', // 마케팅팀 (핑크색)
            4: '#FFBD33', // 회계팀 (노란색)
            5: '#3357FF'  // 영업팀 (파란색)
        };

        var departmentNames = {
            1: "인사팀",
            2: "개발팀",
            3: "마케팅팀",
            4: "회계팀",
            5: "영업팀"
        };

        // 캘린더 설정
        var calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            locale: 'ko',
            events: [],
            fixedWeekCount: false,
            displayEventTime: false,

            // 날짜 클릭 시 일정 추가 모달
            dateClick: function(info) {
                eventTitleInput.value = '';
                eventDescriptionInput.value = '';
                eventStartDateInput.value = info.dateStr + "T09:00"; // 기본값 설정
                eventEndDateInput.value = info.dateStr + "T10:00";   // 기본값 설정
                departmentSelect.value = 1; // 부서 기본값 설정
                colorDisplay.style.backgroundColor = departmentColors[1]; // 기본 색상 설정

                saveEventBtn.onclick = saveEvent;

                deleteEventBtn.style.display = 'none';

                openModal();
            },

            // 일정 클릭 시 상세 보기 모달
            eventClick: function(info) {
                var event = info.event;
                eventTitleInput.value = event.title;
                eventDescriptionInput.value = event.extendedProps.description;
                eventStartDateInput.value = event.startStr;
                eventEndDateInput.value = event.endStr ? event.endStr.split('T')[0] : event.startStr;

                // 부서 이름 표시
                var departmentCode = event.extendedProps.departmentCode;
                departmentSelect.value = departmentCode;
                colorDisplay.style.backgroundColor = departmentColors[departmentCode];

                // 부서 이름을 모달에 표시
                var departmentName = departmentNames[departmentCode];
                departmentSelect.innerHTML = `<option value="${departmentCode}">${departmentName}</option>`;  // 단일 옵션으로 바꾸기

                saveEventBtn.onclick = function() {
                    event.setProp('title', eventTitleInput.value);
                    event.setExtendedProp('description', eventDescriptionInput.value);
                    event.setStart(eventStartDateInput.value);
                    event.setEnd(eventEndDateInput.value || null);
                    event.setExtendedProp('departmentCode', departmentSelect.value);
                    event.setProp('color', departmentColors[departmentSelect.value]);
                    closeModal();
                };

                deleteEventBtn.onclick = function() {
                    event.remove();
                    closeModal();
                };

                deleteEventBtn.style.display = 'inline-block';
                openModal();
            }
        });

        calendar.render();

        // 모달 열기
        function openModal() {
            modal.style.display = 'block';
            modalOverlay.style.display = 'block';
        }

        // 모달 닫기
        function closeModal() {
            modal.style.display = 'none';
            modalOverlay.style.display = 'none';
        }

        closeModalBtn.onclick = closeModal;
        modalOverlay.onclick = closeModal;

        // 저장 일정 처리 함수
        function saveEvent() {
            var eventTitle = eventTitleInput.value;
            var eventDescription = eventDescriptionInput.value;
            var eventStartDate = eventStartDateInput.value;
            var eventEndDate = eventEndDateInput.value;
            var departmentCode = parseInt(departmentSelect.value);
            var eventColor = departmentColors[departmentCode];

            if (eventTitle && eventDescription && eventStartDate && eventEndDate) {
                calendar.addEvent({
                    title: eventTitle,
                    start: eventStartDate,
                    end: eventEndDate,
                    description: eventDescription,
                    color: eventColor,
                    extendedProps: {
                        departmentCode: departmentCode
                    }
                });
                closeModal();
            } else {
                alert('모든 필드를 입력해주세요.');
            }
        }

        // 부서 선택 시 색상 변경
        departmentSelect.addEventListener('change', function() {
            var selectedDept = departmentSelect.value;
            colorDisplay.style.backgroundColor = departmentColors[selectedDept]; // 색상 변경
        });
    });
</script>

</body>
</html>
